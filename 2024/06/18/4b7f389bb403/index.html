

  <!DOCTYPE html>
  <html lang="en" data-default-color-scheme=&#34;dark&#34; >
  <style>
    .text1
    {
    text-shadow: 0px 0px 2px #f2f3f2;
    }
    </style>

  

<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/null">
  <link rel="icon" type="image/png" href="/null">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>事件应急响应专家（五） - whale3070&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.7","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


    <body>
      <header style="height: 70vh;">
        <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>InfoSec learning</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          
        
      </ul>
    </div>
  </div>
</nav>

          <div class="banner" id="banner" false
            style="background: url('/img/default.png') no-repeat center center;
              background-size: cover;">
              <div class="full-bg-img">
                <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
                  <div class="page-header text-center fade-in-up">
                    <span class="h2 text1" id="subtitle" title="事件应急响应专家（五）">
                      
                        事件应急响应专家（五）
                      
                    </span>
        
                    
                      <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2024-06-18 06:24" pubdate>
        June 18, 2024 am
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5.3k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      65
       分钟
    </span>
  

  
  
</div>

                    
                  </div>
                    
                  </div>
                  
                </div>
              </div>
          </div>
      </header>

      <main>
        
          

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">事件应急响应专家（五）</h1>
            
            <div class="markdown-body">
              <p>在<a target="_blank" rel="noopener" href="https://whale3070.github.io/tags/Certified-Incident-Responder/">前四章</a></p>
<p>我们介绍了事件应急响应专家、要使用的工具splunk和搜索处理语言SPL。</p>
<p>今天，我们模拟真实环境，使用splunk来寻找攻击者的踪迹。</p>
<h1 id="有效使用-Splunk（场景-1）"><a href="#有效使用-Splunk（场景-1）" class="headerlink" title="有效使用 Splunk（场景 1）"></a>有效使用 Splunk（场景 1）</h1><p>＃ 设想<br>您工作的组织 (<strong>Wayne Enterprises</strong>) 正在使用 <a target="_blank" rel="noopener" href="https://www.splunk.com/">Splunk</a> 作为 SIEM 解决方案来增强其入侵检测功能。 SOC 经理通知您该组织已受到 APT 组织的攻击。他要求您通过大量利用 Splunk 及其获取的所有数据来响应此事件。<br>Splunk摄取的数据包括Windows事件日志、Sysmon日志、Fortinet下一代防火墙日志、Suricata日志等。<br><strong>注</strong>：本实验基于Splunk发布的<a target="_blank" rel="noopener" href="https://github.com/splunk/botsv1">Boss Of The SOC (BOTS) v1数据集</a>。感谢 <a target="_blank" rel="noopener" href="https://twitter.com/meansec">RyanKovar</a>、<a target="_blank" rel="noopener" href="https://twitter.com/daveherrald?lang=el">Dave Herrald</a> 和 [John Stoner](<a target="_blank" rel="noopener" href="https://twitter.com/">https://twitter.com/</a> Stonerpsu）通过此数据集与公众分享本实验室介绍的 Splunk 检测技巧。 </p>
<h1 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h1><p>本实验的学习目标不仅是熟悉Splunk的架构和检测功能，还要学习有效的Splunk搜索编写。<br>具体来说，您将学习如何使用 Splunk 的功能来： </p>
<ul>
<li>通过网络获得更好的可见性 </li>
<li>及时有效地响应事件 </li>
<li>主动寻找威胁 </li>
</ul>
<h2 id="任务-1：通过-Splunk-搜索识别针对您的网络的任何侦察活动"><a href="#任务-1：通过-Splunk-搜索识别针对您的网络的任何侦察活动" class="headerlink" title="任务 1：通过 Splunk 搜索识别针对您的网络的任何侦察活动"></a>任务 1：通过 Splunk 搜索识别针对您的网络的任何侦察活动</h2><p>使用 Splunk 的功能，尝试识别 APTgroup 执行的任何侦察活动。您组织的网站是 <strong>imreallynotbatman.com。</strong><br><strong>提示</strong>： </p>
<ul>
<li>关注 <strong>stream:http</strong> 源类型并识别负责大部分流量的源 IP。然后，使用 <strong>suricata</strong> 源类型验证您的发现。 </li>
<li>通过分析所有重要字段和来源类型来深入调查 ## 任务 2：识别网络上的任何武器化活动<br>使用开源情报 (OSINT)，尝试识别 APT 组织执行的任何武器化活动。 </li>
</ul>
<p><strong>提示</strong>： </p>
<ul>
<li>识别与预先准备攻击 Wayne Enterprises 的域相关的任何 IP 地址 - 尝试了解 IP 地址和域之间的关联以及其他 - 执行与上述相同的操作，将攻击者电子邮件与互联网上的基础设施关联起来 ## 任务 3 ：识别您网络上的任何交付活动<br>使用 OSINT，尝试识别 APT 组织执行的任何交付活动。具体来说，尝试识别与您之前发现的攻击者基础设施相关的恶意软件。 </li>
</ul>
<p><strong>提示</strong>： </p>
<ul>
<li>将任何与攻击者相关的 IP 地址提交给 ThreatMiner、VirusTotal 和 Hybrid Analysis 等开放源 <h2 id="任务-4：通过-Splunk-搜索识别网络上的任何利用活动-使用-Splunk-的功能，尝试识别-APT-组执行的任何利用活动。"><a href="#任务-4：通过-Splunk-搜索识别网络上的任何利用活动-使用-Splunk-的功能，尝试识别-APT-组执行的任何利用活动。" class="headerlink" title="任务 4：通过 Splunk 搜索识别网络上的任何利用活动 使用 Splunk 的功能，尝试识别 APT 组执行的任何利用活动。"></a>任务 4：通过 Splunk 搜索识别网络上的任何利用活动 使用 Splunk 的功能，尝试识别 APT 组执行的任何利用活动。</h2></li>
</ul>
<p><strong>提示</strong>： </p>
<ul>
<li>关注 <strong>stream:http</strong> 和 <strong>iis</strong> 源类型，并确定哪个服务器是目标以及它使用的内容管理系统 </li>
<li>重点关注 <strong>stream:http</strong> 源类型并识别暴力攻击的来源 - 通过分析所有重要字段和源类型来更深入地进行调查 ## 任务 5：通过 Splunk 搜索识别网络上的任何安装活动 使用 Splunk功能，尝试识别 APT 组执行的任何安装活动。 <strong>提示</strong>： </li>
<li>关注 <strong>stream:http</strong> 和 <strong>suricata</strong> 源类型以识别任何上传的可执行文件 </li>
<li>利用 Sysmon 日志来识别有关任何上传的可执行文件的附加信息 <h2 id="任务-6：通过-Splunk-搜索识别网络上任何与命令和控制相关的活动"><a href="#任务-6：通过-Splunk-搜索识别网络上任何与命令和控制相关的活动" class="headerlink" title="任务 6：通过 Splunk 搜索识别网络上任何与命令和控制相关的活动"></a>任务 6：通过 Splunk 搜索识别网络上任何与命令和控制相关的活动</h2>使用 Splunk 的功能，尝试识别 APT 组执行的任何与命令和控制 (C2) 相关的活动。 </li>
</ul>
<p><strong>提示</strong>： </p>
<ul>
<li>重点关注 <strong>stream:http、</strong> <strong>fgt_utm、</strong> 和 <strong>stream:dns</strong> 源类型，以识别充当命令和控制的任何域。 <h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1>您可以在下面找到本实验室每项任务的解决方案。但请记住，您可以遵循自己的策略，该策略可能与以下实验中解释的策略不同。 <h2 id="任务-1：通过-Splunk-搜索识别针对您的网络的任何侦察活动-1"><a href="#任务-1：通过-Splunk-搜索识别针对您的网络的任何侦察活动-1" class="headerlink" title="任务 1：通过 Splunk 搜索识别针对您的网络的任何侦察活动"></a>任务 1：通过 Splunk 搜索识别针对您的网络的任何侦察活动</h2>登录 Splunk 的 Web 管理界面后，单击位于左侧 <strong>应用程序</strong> 列中的<strong>搜索和报告</strong>应用程序。您应该会看到类似于下面的内容。<br>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a></li>
</ul>
<p>法师11.png)<br>为了测试 Splunk 是否可以成功访问提取/加载的数据，首先将时间范围选择器更改为<strong>所有时间</strong>，然后提交以下搜索。 </p>
<figure class="highlight fix"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs fix"><span class="hljs-attr">索引</span>=<span class="hljs-string">“botsv1”最早= 0 </span><br></code></pre></div></td></tr></table></figure>
<p>您应该会看到事件的数量随着时间的推移而增加。<br>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage12.png)<br>现在我们知道一切都按预期进行，让我们确定针对韦恩企业的任何侦察活动。提醒一下，该组织的网站是 <strong>imreallynotbatman.com</strong>。<br>我们应该做的第一件事是确定要搜索的源类型。具体来说，我们应该首先确定与 <strong>imreallynotbatman.com</strong> 关联的源类型。我们可以通过将时间范围选择器更改为 <strong>所有时间</strong> 并提交以下 Splunk 搜索来实现。 </p>
<figure class="highlight fix"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs fix"><span class="hljs-attr">索引</span>=<span class="hljs-string">botsv1 imreallynotbatman.com </span><br></code></pre></div></td></tr></table></figure>
<p>您应该会看到类似于下面的内容。<br>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage13.png)<br>要确定源类型，只需单击<strong>源类型</strong>（上面的红色矩形）。您应该看到以下内容。<br>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage14.png)<br>我们还可以识别所有源地址。我们可以通过之前的搜索来做到这一点，但是这次我们将向下滚动并单击 <strong>src</strong> 字段，如下所示。<br>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage15.png)<br>由于我们对识别侦察活动感兴趣，因此最好将重点放在</p>
<p><strong>流：http</strong> 源类型。 （Stream 是 Splunk 的一款免费应用程序，可收集线路数据，并可关注多种不同的协议，包括 smtp、tcp、ip、http 等。） </p>
<figure class="highlight fix"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs fix"><span class="hljs-attr">索引</span>=<span class="hljs-string">botsv1 imreallynotbatman.com 源类型=流：http </span><br></code></pre></div></td></tr></table></figure>
<p>如果我们这样做，源将缩小到两个：<strong>40.80.148.42</strong>和<strong>23.22.63.114</strong>。 <strong>40.80.148.42</strong> 与大约 95% 的 http 流量相关，因此我们暂时关注这一点。<br>识别所有来源的另一种方法如下。 </p>
<figure class="highlight gherkin"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gherkin">索引=botsv1 imreallynotbatman.com 源类型=流<span class="hljs-symbol">*</span> |<span class="hljs-string">统计计数（src_ip）作为 src_ip 的请求 </span>|<span class="hljs-string">排序 - 请求 </span><br></code></pre></div></td></tr></table></figure>
<p>到目前为止，我们只能假设 <strong>40.80.148.42</strong> 是 APT 组织执行侦察/扫描活动的 IP。我们可以通过检查 Suricata 来验证这一发现，如下所示。 </p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">索引=botsv1 imreallynotbatman.com src=<span class="hljs-number">40.80</span>.<span class="hljs-number">148.42</span> sourcetype=suricata ``` <br>我们看到与 **<span class="hljs-number">40.80</span>.<span class="hljs-number">148.42</span>** 相关的 Suricata 日志，但没有签名字段。我们可以通过向下滚动、单击**更多字段**并选择**签名**来查看签名。如果我们这样做，签名字段将在**所选字段**列下可见。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage16.png) <br>从触发的 Suricata 签名中，我们可以得出结论：**<span class="hljs-number">40.80</span>.<span class="hljs-number">148.42</span>** 实际上是在扫描 **imreallynotbatman.com**。 <br>我们也有兴趣了解对手的复杂程度。那么出现的问题是，APT 组织是否使用了已知或复杂的扫描技术？让我们看一下提交的请求来回答这个问题。 <br></code></pre></div></td></tr></table></figure>
<p>索引=botsv1 src=40.80.148.42 源类型=流:http </p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"><br>详细的请求信息可以在 **src_headers** 字段中找到。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage17.png) <br>APT 组织利用了信誉良好的 [Acunetix](https:<span class="hljs-regexp">//</span>www.acunetix.com/) 漏洞扫描程序的实例。 <br>我们还可以通过寻找不常见的用户代理来识别该工具的用法。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage18.png) <br>我们可以通过相同的搜索和 **dest** 字段轻松识别哪个服务器是目标。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage19.png) <br>目标显然是**<span class="hljs-number">192.168</span>.<span class="hljs-number">250.70</span>**。 <br>如果我们想更仔细地了解 APT 组织的请求，我们可以按如下方式进行。 <br></code></pre></div></td></tr></table></figure>
<p>索引=botsv1 dest=192.168.250.70 源类型=流:http </p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">所请求的 URL 可以在 **uri** 字段中找到。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage20.png) <br>我们还对成功的页面加载感兴趣。我们可以识别它们，如下所示。 <br></code></pre></div></td></tr></table></figure>
<p>索引=botsv1 dest=192.168.250.70 源类型=流：http 状态=200 |按 uri 统计计数 |排序-计数 </p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage21.png) <br>我们可以通过 **iis** 源类型获得类似的结果，如下所示。 （这次我们<br>正在使用名为 **stats** 的转换搜索命令，该命令允许我们计算按 URI 分组的事件数量。） <br></code></pre></div></td></tr></table></figure>
<p>索引=botsv1 源类型=iis sc_status=200 |统计值(cs_uri_stem) </p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage22.png) <br>您可能想知道为什么我们不指定 **<span class="hljs-number">192.168</span>.<span class="hljs-number">250.70</span>**。这是因为，如果我们提交以下内容并检查主机字段，我们将只找到一台主机，**we1149srv**。该主机的IP地址是**<span class="hljs-number">192.168</span>.<span class="hljs-number">250.70</span>** <br></code></pre></div></td></tr></table></figure>
<p>索引=botsv1 源类型=iis </p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage23.png) <br>以下是我们迄今为止的发现。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage24.png) <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage25.png) <br><span class="hljs-comment">## 任务 2：识别网络上的任何武器化活动 </span><br>此时，我们需要明白Splunk并不是万能的。在我们的调查过程中，并非所有答案都可以在 SIEM 中找到。有时我们需要从 SIEM 转向其他内部或开源来寻找答案。 <br>我们有兴趣识别预先准备攻击 Wayne Enterprises 的域。 <br>我们通过 Splunk 仔细查看了 **<span class="hljs-number">40.80</span>.<span class="hljs-number">148.42</span>** IP 地址。让我们对 **<span class="hljs-number">23.22</span>.<span class="hljs-number">63.114</span>** 执行相同的操作，但通过开源进行，因为 Splunk 不包含太多有关它的信息。 <br>如果我们去 [http:<span class="hljs-regexp">//</span>www.robtex.com](http:<span class="hljs-regexp">//</span>www.robtex.com/) 这样的开源网站并提交 **<span class="hljs-number">23.22</span>.<span class="hljs-number">63.114</span>** IP，我们会遇到以下情况。<br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage26.png) <br>正如我们所看到的，该 IP 有许多与其关联的其他域名。这些域名很可能是网络钓鱼域名，因为它们的名称与我们工作的组织 **Wayne Enterprises** 相似。 <br>[https:<span class="hljs-regexp">//</span>threatcrowd.org](https:<span class="hljs-regexp">//</span>threatcrowd.org<span class="hljs-regexp">/) 和 [https://www.virustotal.com](https:/</span><span class="hljs-regexp">/www.virustotal.com/</span>) 等开源可以为我们提供附加信息。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage27.png) <br>例如，通过 Threatcrowd.org，我们只需提交 **<span class="hljs-number">23.22</span>.<span class="hljs-number">63.114</span>** IP，即可识别与我们正在处理的 APTgroup 相关的其他域。 <br>还记得我们讨论过 Whois 信息以及攻击者如何利用这些信息进行有针对性的攻击吗？好吧，让我们通过检查每个关联域的 whois 信息来让攻击者尝尝自己的毒药。 <br>在检查 **wayncorpinc.com** 的 whois 信息时，我们遇到以下情况。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage28.png) <br>然后，我们可以继续进行反向电子邮件搜索，并可能识别与 APT 组织相关的其他基础设施。下面是反向电子邮件搜索的示例。 <br>&lt;https:<span class="hljs-regexp">//</span>www.threatcrowd.org/email.php?email=LILLIAN.ROSE@PO1S0N1VY.COM&gt; 以下是我们迄今为止的发现： <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage29.png) <br><span class="hljs-comment">## 任务 3：识别网络上的任何交付活动 </span><br>我们需要尽可能多地了解该 APT 组织的 TTP 和使用的恶意软件，因此让我们通过开源进行深入挖掘。 <br>[https:<span class="hljs-regexp">//</span>www.threatminer.org](https:<span class="hljs-regexp">//</span>www.threatminer.org/) 具有在搜索 IP 地址信息时包含相关恶意软件样本的强大功能。这是我们在搜索有关 **<span class="hljs-number">23.22</span>.<span class="hljs-number">63.114</span>** 的信息时会遇到的情况<br>**threatminer.org**。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage30.png) <br>然后，我们可以将这些 MD5 哈希值提交给 Threatminer、VirusTotal 或 Hybrid-analysis.com 等开放源，以识别有关样本的其他元数据。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage31.png) <br>APT 组织可能会制造突变体，因此哈希值可能没有用处。我们应该记下该文件名，以防他们保留该文件名。 <br>以下是我们迄今为止的发现。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage32.png) <br><span class="hljs-comment">## 任务 4：通过 Splunk 搜索识别网络上的任何利用活动 </span><br>现在是我们返回 Splunk 来识别任何利用活动的时候了。我们首先确定与最大数量的 http 事件关联的源 IP 地址。我们可以这样做，如下所示。 <br></code></pre></div></td></tr></table></figure>
<p>index=botsv1 sourcetype=stream:http dest=”192.168.250.70” http_method=POST ```<br><strong>src</strong> 字段包含我们正在寻找的内容。我们指定我们对 POST 请求感兴趣，因为登录通常是通过 POST 请求执行的（稍后会详细介绍）。<br>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage33.png)<br>我们来看看 <strong>40.80.148.42</strong> 发出的那些 POST 请求 </p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><span class="hljs-attribute">index</span>=botsv1 <span class="hljs-attribute">sourcetype</span>=stream:http <span class="hljs-attribute">dest</span>=<span class="hljs-string">&quot;192.168.250.70&quot;</span> <span class="hljs-attribute">http_method</span>=POSTsrc=&quot;40.80.148.42&quot; <br></code></pre></div></td></tr></table></figure>
<p><strong>form_data</strong> 字段包含我们在处理 POST 请求时要检查的信息。<br>没有任何理由可以证明成功的剥削活动是合理的。让我们检查 <strong>23.22.63.114</strong>。 </p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><span class="hljs-attribute">index</span>=botsv1 <span class="hljs-attribute">sourcetype</span>=stream:http <span class="hljs-attribute">dest</span>=<span class="hljs-string">&quot;192.168.250.70&quot;</span> <span class="hljs-attribute">http_method</span>=POSTsrc=&quot;23.22.63.114&quot; <br></code></pre></div></td></tr></table></figure>
<p>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage34.png)<br>看起来 <strong>23.22.63.114</strong> 正在强制 Web 服务器进行身份验证。让我们确认一下，如下。 </p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><span class="hljs-attribute">index</span>=botsv1 <span class="hljs-attribute">sourcetype</span>=stream:http <span class="hljs-attribute">dest</span>=<span class="hljs-string">&quot;192.168.250.70&quot;</span> <span class="hljs-attribute">http_method</span>=POSTform_data=*用户名*passwd* |按 src 统计计数 <br></code></pre></div></td></tr></table></figure>
<p>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage35.png)<br>事实上 <strong>23.22.63.114</strong> 对 Web 服务器的身份验证执行了暴力攻击。<br>我们很想知道暴力攻击是否成功。我们可以确定这一点，如下所示。 </p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><span class="hljs-attribute">index</span>=botsv1 <span class="hljs-attribute">sourcetype</span>=stream:http <span class="hljs-attribute">form_data</span>=*用户名*passwd* <span class="hljs-attribute">dest_ip</span>=192.168.250.70| rex <span class="hljs-attribute">field</span>=form_data <span class="hljs-string">&quot;passwd=(?&lt;用户密码&gt;\w+)&quot;</span> |按用户密码统计计数 |排序-计数 <br></code></pre></div></td></tr></table></figure>
<p>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage36.png)<br>上面的搜索提取每个用户密码并计算其被看到/使用的次数。如果密码出现多次，这可能意味着攻击者受到攻击并再次使用该密码登录。这就是我们按计数排序的原因。<br>如果我们想了解妥协的时间和目标 URI，我们可以按如下方式进行。 </p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><span class="hljs-attribute">index</span>=botsv1 <span class="hljs-attribute">sourcetype</span>=stream:http <span class="hljs-attribute">form_data</span>=*用户名*passwd* <span class="hljs-attribute">dest_ip</span>=192.168.250.70<br>src = 40.80.148.42 | rex <span class="hljs-attribute">field</span>=form_data <span class="hljs-string">&quot;passwd=(?&lt;用户密码&gt;\w+)&quot;</span>|搜索用户密码=* |表 _time uri 用户密码 <br></code></pre></div></td></tr></table></figure>
<p>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage37.png)<br>最后，如果我们想查看两次成功的登录，我们可以这样做，如下所示。 </p>
<figure class="highlight coq"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs coq">索引 = botsv1 源类型 = 流：http | <span class="hljs-type">rex</span> <span class="hljs-built_in">field</span>=form_data <span class="hljs-string">&quot;passwd=(?&lt;用户密码&gt;\w+)&quot;</span> |<span class="hljs-type">搜索用户密码=batman</span> |<span class="hljs-type">表 _time</span> 用户密码 src <br></code></pre></div></td></tr></table></figure>
<p>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage38.png)<br>以下是我们迄今为止的发现。<br>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage39.png)<br>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage40.png) </p>
<h2 id="任务-5：通过-Splunk-搜索识别网络上的任何安装活动"><a href="#任务-5：通过-Splunk-搜索识别网络上的任何安装活动" class="headerlink" title="任务 5：通过 Splunk 搜索识别网络上的任何安装活动"></a>任务 5：通过 Splunk 搜索识别网络上的任何安装活动</h2><p>就网络杀伤链的安装阶段而言，我们最感兴趣的是识别正在上传的任何恶意软件。<br>我们可以通过各种源类型来识别，特别是 <strong>stream:http</strong> 和 <strong>Suricata</strong>。 </p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">index=botsv1 sourcetype=stream:http dest=<span class="hljs-string">&quot;192.168.250.70&quot;</span> *.exe ``` <br>**part_filename&#123;&#125;** 字段包含我们要检查的信息。默认情况下它是不可见的，所以添加它。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage41.png) <br></code></pre></div></td></tr></table></figure>
<p>index=botsv1 sourcetype=suricata (dest=imreallynotbatman.com OR dest=”192.168.250.70”) http.http_method=POST .exe</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">**fileinfo.filename** 字段包含我们要检查的信息。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage42.png) <br>**<span class="hljs-number">3791</span>.exe** 必须是上传的恶意软件。 <br>可以轻松识别文件上传的来源，如下所示。 <br></code></pre></div></td></tr></table></figure>
<p>index=botsv1 sourcetype=suricata dest_ip=”192.168.250.70” http.http_method=POST .exe ```<br>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage43.png)<br>如果我们还可以识别上传文件的哈希值，那就太好了。但是我们应该使用什么源类型呢？我们来了解一下，如下。 </p>
<figure class="highlight fix"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs fix"><span class="hljs-attr">索引</span>=<span class="hljs-string">botsv1 3791.exe </span><br></code></pre></div></td></tr></table></figure>
<p>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage44.png)<br>Sysmon 是一个很好的候选者，因为它记录文件的 MD5、SHA1 和 SHA256 哈希值等信息。 </p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">索引=botsv1 3791.exe 源类型=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational `` <br>在本例中，重要的字段是 <span class="hljs-strong">**Hashes**</span>、<span class="hljs-strong">**CommandLine**</span> 和 <span class="hljs-strong">**ParentCommandLine**</span>。您必须添加最后两个，因为默认情况下它们不可见。 <br>在分析结果之前，让我们先缩小范围。 <br></code></pre></div></td></tr></table></figure>
<p>索引=botsv1 3791.exe 源类型=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational EventCode=1</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-string">上面的搜索包括</span> <span class="hljs-string">EventCode</span> <span class="hljs-number">1</span><span class="hljs-string">，因为该</span> <span class="hljs-string">EventCode</span> <span class="hljs-string">与流程创建事件相关。不幸的是，为了获取上传文件的</span> <span class="hljs-string">MD5</span> <span class="hljs-string">哈希值，我们需要进一步缩小范围。具体来说，我们需要在命令行字段中搜索</span> <span class="hljs-number">3791.</span><span class="hljs-string">exe，因为该字段捕获进程启动。</span> <br><span class="hljs-string">所以，最终的搜索结果如下。</span> <br></code></pre></div></td></tr></table></figure>
<p>索引=botsv1 3791.exe 命令行=3791.exe |统计值(md5) </p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage45.png) <br>以下是我们迄今为止的发现。 <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage46.png) <br>![](https:<span class="hljs-regexp">//</span>assets.ine.com<span class="hljs-regexp">/cybersecurity-lab-images/</span>b75194df-<span class="hljs-number">9</span>a04-<span class="hljs-number">4879</span>-<span class="hljs-number">95</span>c8-d88b1fc54d1b/i mage47.png) <br><span class="hljs-comment">## 任务 6：通过 Splunk 搜索识别网络上任何与命令和控制相关的活动 </span><br>就网络杀伤链的命令和控制阶段而言，我们最感兴趣的是识别用于命令和控制目的的任何域。 <br>Splunk 内部有一个强大的盟友来帮助我们回答此类问题。这个盟友是**stream.dns** 源类型。由于我们已经知道 **<span class="hljs-number">23.22</span>.<span class="hljs-number">63.114</span>** 值得关注，因此我们可以利用 Splunk 和 **stream.dns** 源类型来识别 DNS​​ 事件，其中 **<span class="hljs-number">22.23</span>.<span class="hljs-number">63.114</span>** 是答案。 <br></code></pre></div></td></tr></table></figure>
<p>索引=botsv1 答案=23.22.63.114 源类型=流：dns |统计值（“名称{}”）```<br>![](<a target="_blank" rel="noopener" href="https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i">https://assets.ine.com/cybersecurity-lab-images/b75194df-9a04-4879-95c8-d88b1fc54d1b/i</a> mage48.png)<br>如果您仔细观察，您会发现<strong>prankglassinebracket.jumpingcrab.com</strong>域已被攻击者用来破坏网络服务器。试一试…</p>
<p><strong>参考：</strong> </p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.slideshare.net/Splunk/splunk-data-onboarding-overview-splunk-data-collection-architecture">https://www.slideshare.net/Splunk/splunk-data-onboarding-overview-splunk-data-collection-architecture</a> </li>
<li><a target="_blank" rel="noopener" href="https://www.splunk.com/en_us/training.html">https://www.splunk.com/en_us/training.html</a></li>
</ol>
<h1 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h1><h2 id="任务-1：通过Splunk搜索识别针对您网络的任何侦察活动"><a href="#任务-1：通过Splunk搜索识别针对您网络的任何侦察活动" class="headerlink" title="任务 1：通过Splunk搜索识别针对您网络的任何侦察活动"></a>任务 1：通过Splunk搜索识别针对您网络的任何侦察活动</h2><p>利用Splunk的能力，尝试识别由APT组织执行的任何侦察活动。您组织的网站是imreallynotbatman.com。</p>
<p>提示：</p>
<p>集中在stream:http sourcetype上，识别负责大部分流量的源IP。然后，使用suricata sourcetype验证您的发现。</p>
<p>通过分析所有重要字段和sourcetype，深入进行调查。</p>
<h2 id="任务一答案"><a href="#任务一答案" class="headerlink" title="任务一答案"></a>任务一答案</h2><p>要识别APT的活动，提示告诉了我们要先分析http的请求</p>
<p>一旦您登录到Splunk的Web管理界面，请点击左侧应用栏中的“搜索与报告”应用程序。您应该看到类似以下的界面。</p>
<p><img src="https://assets.ine.com/content/ptp/Effectively_Using_Splunk_Scenario_1/9.jpg" srcset="/img/loading.gif"></p>
<h2 id="任务-2：在您的网络中识别任何武器化活动"><a href="#任务-2：在您的网络中识别任何武器化活动" class="headerlink" title="任务 2：在您的网络中识别任何武器化活动"></a>任务 2：在您的网络中识别任何武器化活动</h2><p>利用开源情报（OSINT），尝试识别由APT组织执行的任何武器化活动。</p>
<p>提示：</p>
<p>识别与预置攻击韦恩企业相关的任何域名绑定的IP地址。</p>
<p>尝试理解IP地址与域名等之间的关联。</p>
<p>对攻击者电子邮件与互联网基础设施之间的关联进行相同操作。</p>
<h2 id="任务-3：通过OSINT识别您网络中的任何交付活动"><a href="#任务-3：通过OSINT识别您网络中的任何交付活动" class="headerlink" title="任务 3：通过OSINT识别您网络中的任何交付活动"></a>任务 3：通过OSINT识别您网络中的任何交付活动</h2><p>利用开源情报（OSINT），尝试识别由APT组织执行的任何交付活动。具体来说，尝试识别与您先前发现的攻击者基础设施相关联的恶意软件。</p>
<p>提示：</p>
<p>提交任何攻击者相关的IP地址到ThreatMiner、VirusTotal和Hybrid Analysis等开放资源。</p>
<h2 id="任务-4：通过Splunk搜索识别您网络中的任何利用活动"><a href="#任务-4：通过Splunk搜索识别您网络中的任何利用活动" class="headerlink" title="任务 4：通过Splunk搜索识别您网络中的任何利用活动"></a>任务 4：通过Splunk搜索识别您网络中的任何利用活动</h2><p>利用Splunk的能力，尝试识别由APT组织执行的任何利用活动。</p>
<p>提示：</p>
<p>集中在stream:http和iis sourcetypes上，识别作为目标的您的服务器以及其使用的内容管理系统。</p>
<p>集中在stream:http sourcetype上，识别暴力攻击的源头。</p>
<p>通过分析所有重要字段和sourcetype，深入进行调查。</p>
<h2 id="任务-5：通过Splunk搜索识别您网络中的任何安装活动"><a href="#任务-5：通过Splunk搜索识别您网络中的任何安装活动" class="headerlink" title="任务 5：通过Splunk搜索识别您网络中的任何安装活动"></a>任务 5：通过Splunk搜索识别您网络中的任何安装活动</h2><p>利用Splunk的能力，尝试识别由APT组织执行的任何安装活动。</p>
<p>提示：</p>
<p>集中在stream:http和suricata sourcetypes上，识别任何上传的可执行文件。</p>
<p>利用Sysmon日志，获取有关任何上传的可执行文件的额外信息。</p>
<h2 id="任务-6：通过Splunk搜索识别您网络中的任何命令与控制相关活动"><a href="#任务-6：通过Splunk搜索识别您网络中的任何命令与控制相关活动" class="headerlink" title="任务 6：通过Splunk搜索识别您网络中的任何命令与控制相关活动"></a>任务 6：通过Splunk搜索识别您网络中的任何命令与控制相关活动</h2><p>利用Splunk的能力，尝试识别由APT组织执行的任何命令与控制（C2）相关活动。</p>
<p>提示：</p>
<p>集中在stream:http、fgt_utm和stream:dns sourcetypes上，识别任何充当命令与控制的域名。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Certified-Incident-Responder/">Certified Incident Responder</a>
                    
                      <a class="hover-with-bg" href="/tags/Big-Data/">Big Data</a>
                    
                  </div>
                
              </div>
              
                
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/06/18/519c89cb1ad8/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">CISSP+INE（三十）</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/06/14/c635361777c2/">
                        <span class="hidden-mobile">事件应急响应专家（四）</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


            

                
                  <a id="scroll-top-button" href="#" role="button">
                    <i class="iconfont icon-arrowup" aria-hidden="true"></i>
                  </a>
                  

                    
                      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
                        

                          
      </main>

      <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://whale3070.github.io/" target="_blank" rel="nofollow noopener"><span>Whale3070</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>






  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



    </body>

  </html>